<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport"
		content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
	<title>MetaChess</title>
	<link rel="stylesheet" href="lib/chessboard.css">
	<link rel="icon" href="favicon.ico" type="image/x-icon">
	<link rel="stylesheet" href="css/base.css">
	<link rel="stylesheet" href="css/layout.css">
	<link rel="stylesheet" href="css/cards.css">
	<link rel="stylesheet" href="css/modals.css">
	<link rel="stylesheet" href="css/mobile.css">
	<link rel="stylesheet" href="css/material-diff.css">
	<link rel="stylesheet" href="css/mainMenu.css">
	<link rel="stylesheet" href="css/deckModal.css">
</head>

<body>
	<section id="main-menu-landing">
		<div class="main-menu-content">
			<h1>MetaChess</h1>
			<button id="main-menu-versus" class="menu-button">Versus</button>
			<button id="main-menu-settings" class="menu-button">Settings</button>
			<button id="main-menu-profile" class="menu-button">Profile</button>
		</div>
	</section>
	<div class="container">
		<div id="status-frame">
			<div id="status-message">Ready</div>
		</div>
		<div id="board-container">
			<div class="opponent-info">
				<div class="deck-info">
					<span class="deck-count">Deck: <span id="opponent-deck-count">60</span></span>
				</div>
				<div class="timer black-timer">
					<span id="black-time">3:00</span>
				</div>
				<button id="menu-button" class="menu-button">Menu</button>
			</div>
			<div class="material-difference top-material"></div>
			<div id="chessboard"></div>
			<div class="material-difference bottom-material"></div>
			<div class="player-info">
				<button id="player-deck-count-btn" class="deck-button" type="button">
					<div class="deck-info">
						<span class="deck-count">Deck: <span id="player-deck-count">60</span></span>
					</div>
				</button>

				<div class="timer white-timer">
					<span id="white-time">3:00</span>
				</div>
				<button id="pass-turn" class="pass-button">Pass</button>
			</div>

			<div id="game-options-modal" class="modal">
				<div class="modal-content small-modal">
					<div class="modal-header">
						<h3>Game Options</h3>
						<span class="close-modal">&times;</span>
					</div>
					<div class="modal-body">
						<button id="rematch-btn" class="menu-button" disabled>Rematch</button>
						<button id="multiplayer-btn" class="multiplayer-button">Versus</button>
						<button id="concede-button" class="menu-button danger">Concede Game</button>
					</div>
				</div>
			</div>

			<!-- Concede Confirmation Modal -->
			<div id="concede-confirm-modal" class="modal">
				<div class="modal-content small-modal">
					<div class="modal-header">
						<h3>Confirm Concede</h3>
						<span class="close-modal">&times;</span>
					</div>
					<div class="modal-body">
						<p>Are you sure you want to concede the game?</p>
						<div class="button-row">
							<button id="confirm-concede" class="menu-button danger">Yes, Concede</button>
							<button id="cancel-concede" class="menu-button">Cancel</button>
						</div>
					</div>
				</div>
			</div>
		</div>

		<!-- Player's cards -->
		<div class="player-frame" id="player-area">
			<div class="player-controls-row">
			</div>
			<div class="card-container" id="player-cards">
				<!-- Cards will be generated here by JavaScript -->
			</div>
		</div>

		<!-- Remove the timers from their original locations -->
		<!-- Keep status frame but hidden -->
		<div id="status-frame" style="display: none;">
			<div id="status-message">Ready</div>
		</div>

		<!-- Keep your modals but ensure they're hidden by default -->
		<div class="modal" id="multiplayer-modal" style="display: none;">
			<div class="modal-content">
				<h2>Multiplayer Options</h2>
				<button id="create-game-btn">Create New Game</button>
				<div class="separator">OR</div>
				<div class="join-game-form">
					<input type="text" id="game-id-input" placeholder="Enter Game ID">
					<button id="join-game-btn">Join Game</button>
				</div>
				<button id="cancel-multiplayer" class="cancel-button">Cancel</button>
			</div>
		</div>

		<div class="modal" id="waiting-modal" style="display: none;">
			<div class="modal-content">
				<h2>Waiting for opponent</h2>
				<p>Share this game link with a friend to play:</p>
				<div class="copy-link-container">
					<input type="text" id="game-link" readonly>
					<button id="copy-link">Copy Link</button>
				</div>
				<button id="cancel-waiting" class="cancel-button"
					onclick="console.log('INLINE: Cancel waiting clicked'); document.getElementById('waiting-modal').style.display = 'none';">Cancel</button>
			</div>
		</div>
		<div id="deck-composition-modal" class="modal">
			<div class="modal-content small-modal">
				<div class="modal-header">
					<h3>Deck Composition</h3>
					<span class="close-modal" id="close-deck-modal">&times;</span>
				</div>
				<div class="modal-body" id="deck-composition-body">
					<!-- Deck composition will be injected here -->
				</div>
			</div>
		</div>
		<div id="rematch-pending-modal" class="modal" style="display:none;">
			<div class="modal-content small-modal">
				<div class="modal-header">
					<h3>Rematch</h3>
				</div>
				<div class="modal-body">
					<p>Rematch offer pending...</p>
				</div>
			</div>
		</div>
		<div id="login-modal" class="modal" style="display:none;">
			<div class="modal-content">
				<div class="modal-header">
					<h3>Login / Register</h3>
					<span class="close-modal"
						onclick="document.getElementById('login-modal').style.display = 'none'">&times;</span>
				</div>
				<div class="modal-body">
					<!-- Login Form -->
					<div id="login-form">
						<h4>Login</h4>
						<form id="login-form-element">
							<input type="email" id="login-email" placeholder="Email" required>
							<input type="password" id="login-password" placeholder="Password" required>
							<button type="submit">Login</button>
						</form>
						<p>Don't have an account? <a href="#" id="show-register">Register here</a></p>
					</div>

					<!-- Register Form -->
					<div id="register-form" style="display:none;">
						<h4>Register</h4>
						<form id="register-form-element">
							<input type="text" id="register-username" placeholder="Username" required>
							<input type="email" id="register-email" placeholder="Email" required>
							<input type="password" id="register-password" placeholder="Password" required>
							<button type="submit">Register</button>
						</form>
						<p>Already have an account? <a href="#" id="show-login">Login here</a></p>
					</div>

					<div id="auth-message" style="margin-top: 10px; text-align: center;"></div>
				</div>
			</div>
		</div>
		<div id="deck-editor-modal" class="modal" style="display:none;">
			<div class="modal-content">
				<div class="modal-header">
					<h3>Edit Your Deck</h3>
					<span class="close-modal"
						onclick="document.getElementById('deck-editor-modal').style.display='none'">&times;</span>
				</div>
				<div class="modal-body">
					<form id="deck-editor-form">
						<label>Pawn: <input type="number" id="deck-p" min="1" max="99" value="8"></label><br>
						<label>Knight: <input type="number" id="deck-n" min="1" max="99" value="2"></label><br>
						<label>Bishop: <input type="number" id="deck-b" min="1" max="99" value="2"></label><br>
						<label>Rook: <input type="number" id="deck-r" min="1" max="99" value="2"></label><br>
						<label>Queen: <input type="number" id="deck-q" min="1" max="99" value="1"></label><br>
						<label>King: <input type="number" id="deck-k" min="1" max="99" value="1"></label><br>
						<button type="submit" id="save-deck-btn">Save Deck</button>
					</form>
					<div id="deck-save-message" style="margin-top:10px;text-align:center;"></div>
				</div>
			</div>
		</div>
	</div>

	<!-- External libraries -->
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/stockfish@11/src/stockfish.js"></script>
	<script src="lib/chess.js"></script>
	<script src="lib/chessboard.js"></script>

	<!-- Non-module scripts first -->
	<script src="js/deck.js"></script>
	<script src="js/board.js"></script>
	<script src="js/ui.js"></script>
	<script src="js/stockfish.js"></script>

	<!-- ES6 modules in dependency order -->
	<script type="module" src="js/socket.js"></script> <!-- First - provides utilities -->
	<script type="module" src="js/auth.js"></script> <!-- Second - uses socket utilities -->
	<script type="module" src="js/game_modules/socketListeners.js"></script>
	<script type="module" src="js/game_modules/multiplayer.js"></script>
	<script type="module" src="js/game.js"></script> <!-- Uses socket and modules -->
	<script type="module" src="js/app.js"></script> <!-- Last - uses everything -->

</body>

</html>